"use strict";(()=>{var n=["http://localhost:4000","https:\\/\\/[\\w]{5,6}-4000.pitcher-staging.csb.dev","https:\\/\\/[\\w]{5,6}-4000.pitcher-fc.csb.dev","https:\\/\\/[\\w]{5,6}-4000.csb.app","https://ui.pitcher-local.csb.dev","https://codesandbox.stream","https://codesandbox.io"];var p=n||[],d="INJECT_AND_INVOKE",l="HAS_PREVIEW_LOADED";var S="INJECT_SUCCESS";var v=new RegExp("(?<id>\\w{5,6})-(?<port>\\d{1,5})\\.(?<hostname>.*)"),x="192.168.241.2";function M(t,s){let e=new URL(t);if(!e.port||Number(e.port)<1024)return;let o=e.searchParams.get("csbLocalProxyEnabled");if(e.hostname!==s&&e.hostname!=="localhost"&&e.hostname!==x&&o!=="false")return;let i=s.match(v);if(!(i!=null&&i.groups))return;let{id:a,port:w,hostname:E}=i.groups;if(!(!a||!w||!E))return e.hostname=`${a}-${e.port}.${E}`,e.port="",e.protocol==="http:"?e.protocol="https:":e.protocol==="ws:"&&(e.protocol="wss:"),e.toString()}var _=Symbol("webSocketPatched");function u(){window.WebSocket[_]||(window.WebSocket=class extends window.WebSocket{constructor(s,e){let o=M(s,location.hostname);o&&console.log("CSB: forwarded websocket connection "+s+" to "+o),super(o||s,e)}},Object.defineProperty(window.WebSocket,_,{enumerable:!0,value:!0}))}var I="/csb-sw.js",g="csbLocalProxyEnabled";function L(){let t=localStorage.getItem(g);return t?t==="true":!0}async function R(t){if(t)localStorage.removeItem(g);else{localStorage.setItem(g,t.toString());let s=await navigator.serviceWorker.getRegistration(I);await(s==null?void 0:s.unregister())}window.location.reload()}function P(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{window.enableLocalhostProxy=R,L()&&navigator.serviceWorker.register(I).catch(s=>{console.error("Service Worker registration failed: ",s)})}),u()}function f(t){return t.type===d}function m(t){return t.type===l}function y(t){return t&&typeof t.type=="string"}function T(t,s){return s.some(e=>RegExp(e).test(t))}function h(t){return`(function $csb$eval(module, exports) {${t}
  })`}function W(t){let s=h(t),e={exports:{}};return(0,eval)(s).apply(this,[e,e.exports]),e.exports.activate}var c=class{constructor(){this.origin=null;this.messageListeners={};this.previewOriginInitialized=new Promise(e=>{this.resolver=e}),window.CODESANDBOX_PREVIEW={focusFile:(e,o=0)=>{this.sendOutgoingMessage({type:"FOCUS_FILE",filepath:e,currentLine:o,visibleLines:[o,o]})}};let s=e=>{if(!T(e.origin,window.TRUSTED_PREVIEW_HOSTS||p))return;let o=e.data;if(y(o)){if(f(o)){this.origin=e.origin,this.handleCodeInjection(o),this.resolver&&this.resolver();return}if(m(o)){this.sendOutgoingMessage({type:"PREVIEW_LOADED"});return}if(o.type){let i=this.messageListeners[o.type];i&&i.forEach(a=>a(o))}}};window.addEventListener("message",s),window.addEventListener("beforeunload",()=>{this.sendOutgoingMessage({type:"PREVIEW_UNLOADING"})}),this.sendOutgoingMessage({type:"PREVIEW_LOADED"})}handleCodeInjection(s){W(s.code)({previewWindow:window,previewProtocol:this,scope:s.scope}),this.sendOutgoingMessage({type:S,uid:s.uid})}async sendOutgoingMessage(s){await this.previewOriginInitialized,this.origin&&window.parent.postMessage(s,this.origin)}handleIncomingMessage(s,e){var o;this.messageListeners[s]?(o=this.messageListeners[s])==null||o.push(e):this.messageListeners[s]=[e]}addListener(s,e){this.handleIncomingMessage(s,e)}sendMessage(s){this.sendOutgoingMessage(s)}},A=window.location.origin.split(".")[0].includes("-");A&&P();window.__CSB_PREVIEW_PROTOCOL=new c;})();
